{"is_source_file": true, "format": "TypeScript", "description": "This file defines an Angular service for interfacing with a Supabase backend, handling score saving and leaderboard retrieval for a tic-tac-toe game. It manages database interactions, error handling, and schema compatibility logic.", "external_files": ["../env"], "external_methods": ["createClient"], "published": ["SupabaseService"], "classes": [{"name": "SupabaseService", "description": "An Angular injectable service that interacts with the Supabase backend to store game scores and retrieve leaderboard information."}], "methods": [{"name": "saveScore", "description": "Saves a player's score to the 'scores' table, handling fallback column names and error cases."}, {"name": "getLeaderboard", "description": "Fetches the top scores from the 'scores' table, aggregated by username, with fallback handling for missing columns."}, {"name": "buildInsertPayload", "description": "Constructs the data payload for inserting a score, depending on whether the column is 'result' or 'score'."}, {"name": "aggregateLeaderboard", "description": "Aggregates score rows to produce a sorted leaderboard of top players."}, {"name": "parseDateSafe", "description": "Safely parses a date string into a Date object, defaulting to epoch if invalid."}, {"name": "isMissingTableError", "description": "Detects if an error message indicates a missing database table."}, {"name": "isMissingColumnError", "description": "Detects if an error message indicates a missing column in the database."}, {"name": "schemaHelpMessage", "description": "Provides instructions for creating the required database schema in Supabase."}], "calls": ["createClient", "this.client.from", "this.client.select", "this.client.insert", "this.client.order"], "search-terms": ["SupabaseScoreSave", "LeaderboardRetrieval", "supabase client", "score column fallback", "score schema setup", "Supabase scores table", "Angular Supabase service"], "state": 2, "file_id": 23, "knowledge_revision": 92, "git_revision": "f3d3c8a803703e5430cbf726e75ff58b4f548bb9", "revision_history": [{"64": "cacdd8587e8f9b7d0009dd07d4a29dd7258e6afc"}, {"75": "cacdd8587e8f9b7d0009dd07d4a29dd7258e6afc"}, {"79": "660a6f2e9649977198d160213c45c250e5d62ae1"}, {"84": "b1d16d6b5cdee6f622c50dd21b68e969ea3152ac"}, {"89": "f3d3c8a803703e5430cbf726e75ff58b4f548bb9"}, {"92": "f3d3c8a803703e5430cbf726e75ff58b4f548bb9"}], "ctags": [{"_type": "tag", "name": "LeaderboardRow", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^export type LeaderboardRow = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "ScoreColumnName", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^type ScoreColumnName = 'result' | 'score';$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "ScoreSelectRow", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^type ScoreSelectRow = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "SupabaseClient", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^import { createClient, type SupabaseClient } from '@supabase\\/supabase-js';$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "SupabaseErrorLike", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^type SupabaseErrorLike = { message: string; code?: string };$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "SupabaseService", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^export class SupabaseService {$/", "language": "TypeScript", "kind": "class"}, {"_type": "tag", "name": "byUser", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^    const byUser = new Map<string, { username: string; total: number; last_played: Date }>();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "c", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^    const c = column.toLowerCase();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "client", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^  private readonly client: SupabaseClient | null = HAS_SUPABASE$/", "language": "TypeScript", "kind": "property", "scope": "SupabaseService", "scopeKind": "class"}, {"_type": "tag", "name": "current", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^      const current = byUser.get(username);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "fallback", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^      const fallback: ScoreColumnName = preferred === 'result' ? 'score' : 'result';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "ms", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^    const ms = Date.parse(value);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "msg", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^    const msg = (error.message || '').toLowerCase();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "playedAt", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^      const playedAt = this.parseDateSafe(r.created_at);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "preferred", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^    const preferred: ScoreColumnName = this.scoreColumn ?? 'result';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "primary", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^    const primary = await this.client.from('scores').insert(this.buildInsertPayload(preferred, u/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "r", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^      const username = typeof r.username === 'string' ? r.username : '';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "r", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^    for (const r of rows) {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "rawScore", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^      const rawScore = Number(r[scoreColumn] ?? 0);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "resFallback", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^      const resFallback = await this.client$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "resPrimary", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^    const resPrimary = await this.client$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "score", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^      const score = Number.isFinite(rawScore) ? rawScore : 0;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "secondary", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^      const secondary = await this.client$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "username", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^      const username = typeof r.username === 'string' ? r.username : '';$/", "language": "TypeScript", "kind": "constant"}], "hash": "803d032372d958749118d2d77d3da122", "format-version": 4, "code-base-name": "tic_tac_toe_frontend", "filename": "tic_tac_toe_frontend/src/app/services/supabase.service.ts", "fields": [{"name": "private readonly client: SupabaseClient | null = HAS_SUPABASE", "scope": "SupabaseService", "scopeKind": "class", "description": "unavailable"}]}