{"is_source_file": true, "format": "TypeScript", "description": "This file defines an Angular service called SupabaseService that interacts with a Supabase backend to handle game score storage and retrieval for a Tic-Tac-Toe game. It includes methods to check configuration, save scores, fetch leaderboards, and get user history. It also defines data types for game results and leaderboard entries, and handles connection initialization and error cases.", "external_files": ["../env"], "external_methods": ["createClient"], "published": ["GameResult", "LeaderboardRow", "SupabaseService"], "classes": [{"name": "SupabaseService", "description": "An Angular service that manages interaction with the Supabase backend for storing and retrieving game scores and leaderboards."}], "methods": [{"name": "isConfigured(): boolean { isConfigured", "description": "Checks whether the Supabase client has been successfully configured with environment variables.", "scope": "SupabaseService", "scopeKind": "class"}, {"name": "async saveScore(username: string, result: GameResult): Promise<{ ok: true } | { ok: false; mes/ saveScore", "description": "Saves a game result for a user to the 'scores' table in Supabase; handles errors such as missing schema.", "scope": "SupabaseService", "scopeKind": "class"}, {"name": "async getLeaderboard(): Promise<{ ok: true; data: LeaderboardRow[] } | { ok: false; message: s/ getLeaderboard", "description": "Fetches top 10 leaderboard entries by aggregating scores from recent game results.", "scope": "SupabaseService", "scopeKind": "class"}, {"name": "async getUserHistory( getUserHistory", "description": "Retrieves the last 20 game scores for a specific user.", "scope": "SupabaseService", "scopeKind": "class"}, {"name": "private mapResultToScore(result: GameResult): number { mapResultToScore", "description": "Converts a GameResult ('win', 'draw', 'loss') into a numeric score.", "scope": "SupabaseService", "scopeKind": "class"}, {"name": "private isMissingTableError(error: { message: string; code?: string }): boolean { isMissingTableError", "description": "Detects errors indicating the 'scores' table does not exist in the database.", "scope": "SupabaseService", "scopeKind": "class"}, {"name": "private schemaHelpMessage(): string { schemaHelpMessage", "description": "Provides instructions and a SQL script to create the necessary 'scores' table in Supabase.", "scope": "SupabaseService", "scopeKind": "class"}, {"name": "constructor() { constructor", "scope": "SupabaseService", "scopeKind": "class", "description": "unavailable"}], "calls": ["createClient", "this.client.from('scores').insert()", "this.client.from('scores').select()", "this.client.from('scores').eq()"], "search-terms": ["supabase", "scores table", "leaderboard", "saveScore", "getLeaderboard", "getUserHistory", "SupabaseClient", "environment variables", "supabase-js"], "state": 2, "file_id": 23, "knowledge_revision": 75, "git_revision": "cacdd8587e8f9b7d0009dd07d4a29dd7258e6afc", "revision_history": [{"64": "cacdd8587e8f9b7d0009dd07d4a29dd7258e6afc"}, {"75": "cacdd8587e8f9b7d0009dd07d4a29dd7258e6afc"}], "ctags": [{"_type": "tag", "name": "GameResult", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^export type GameResult = 'win' | 'draw' | 'loss';$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "LeaderboardRow", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^export interface LeaderboardRow {$/", "language": "TypeScript", "kind": "interface"}, {"_type": "tag", "name": "ScoreRow", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^interface ScoreRow {$/", "language": "TypeScript", "kind": "interface"}, {"_type": "tag", "name": "SupabaseClient", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^import { createClient, type SupabaseClient } from '@supabase\\/supabase-js';$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "SupabaseService", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^export class SupabaseService {$/", "language": "TypeScript", "kind": "class"}, {"_type": "tag", "name": "client", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^  private readonly client: SupabaseClient | null;$/", "language": "TypeScript", "kind": "property", "scope": "SupabaseService", "scopeKind": "class"}, {"_type": "tag", "name": "constructor", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^  constructor() {$/", "language": "TypeScript", "kind": "method", "scope": "SupabaseService", "scopeKind": "class"}, {"_type": "tag", "name": "created_at", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^  created_at?: string;$/", "language": "TypeScript", "kind": "property", "scope": "ScoreRow", "scopeKind": "interface"}, {"_type": "tag", "name": "getLeaderboard", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^  async getLeaderboard(): Promise<{ ok: true; data: LeaderboardRow[] } | { ok: false; message: s/", "language": "TypeScript", "kind": "method", "scope": "SupabaseService", "scopeKind": "class"}, {"_type": "tag", "name": "getUserHistory", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^  async getUserHistory($/", "language": "TypeScript", "kind": "method", "scope": "SupabaseService", "scopeKind": "class"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^  id?: string;$/", "language": "TypeScript", "kind": "property", "scope": "ScoreRow", "scopeKind": "interface"}, {"_type": "tag", "name": "insert", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^    const insert = await this.client.from('scores').insert(payload);$/", "language": "TypeScript", "kind": "constant", "scope": "SupabaseService.saveScore", "scopeKind": "method"}, {"_type": "tag", "name": "isConfigured", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^  isConfigured(): boolean {$/", "language": "TypeScript", "kind": "method", "scope": "SupabaseService", "scopeKind": "class"}, {"_type": "tag", "name": "isMissingTableError", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^  private isMissingTableError(error: { message: string; code?: string }): boolean {$/", "language": "TypeScript", "kind": "method", "scope": "SupabaseService", "scopeKind": "class"}, {"_type": "tag", "name": "key", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^    const key = NG_APP_SUPABASE_KEY;$/", "language": "TypeScript", "kind": "constant", "scope": "SupabaseService.constructor", "scopeKind": "method"}, {"_type": "tag", "name": "latest_played", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^  latest_played: string;$/", "language": "TypeScript", "kind": "property", "scope": "LeaderboardRow", "scopeKind": "interface"}, {"_type": "tag", "name": "map", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^      const map = new Map<string, { total: number; latest: string }>();$/", "language": "TypeScript", "kind": "constant", "scope": "SupabaseService.getLeaderboard", "scopeKind": "method"}, {"_type": "tag", "name": "mapResultToScore", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^  private mapResultToScore(result: GameResult): number {$/", "language": "TypeScript", "kind": "method", "scope": "SupabaseService", "scopeKind": "class"}, {"_type": "tag", "name": "msg", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^      const msg = this.schemaHelpMessage();$/", "language": "TypeScript", "kind": "constant", "scope": "SupabaseService.saveScore", "scopeKind": "method"}, {"_type": "tag", "name": "msg", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^    const msg = (error.message || '').toLowerCase();$/", "language": "TypeScript", "kind": "constant", "scope": "SupabaseService.isMissingTableError", "scopeKind": "method"}, {"_type": "tag", "name": "numeric", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^    const numeric = this.mapResultToScore(result);$/", "language": "TypeScript", "kind": "constant", "scope": "SupabaseService.saveScore", "scopeKind": "method"}, {"_type": "tag", "name": "payload", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^    const payload: ScoreRow = { username, result: numeric };$/", "language": "TypeScript", "kind": "constant", "scope": "SupabaseService.saveScore", "scopeKind": "method"}, {"_type": "tag", "name": "prev", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^        const prev = map.get(row.username);$/", "language": "TypeScript", "kind": "constant", "scope": "SupabaseService.getLeaderboard", "scopeKind": "method"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^    const res = await this.client$/", "language": "TypeScript", "kind": "constant", "scope": "SupabaseService.getLeaderboard", "scopeKind": "method"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^    const res = await this.client$/", "language": "TypeScript", "kind": "constant", "scope": "SupabaseService.getUserHistory", "scopeKind": "method"}, {"_type": "tag", "name": "result", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^    const payload: ScoreRow = { username, result: numeric };$/", "language": "TypeScript", "kind": "constant", "scope": "SupabaseService.saveScore", "scopeKind": "method"}, {"_type": "tag", "name": "result", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^  result: number; \\/\\/ 1 | 0.5 | 0$/", "language": "TypeScript", "kind": "property", "scope": "ScoreRow", "scopeKind": "interface"}, {"_type": "tag", "name": "row", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^      for (const row of res.data as ScoreRow[]) {$/", "language": "TypeScript", "kind": "constant", "scope": "SupabaseService.getLeaderboard", "scopeKind": "method"}, {"_type": "tag", "name": "rows", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^      const rows: LeaderboardRow[] = Array.from(map.entries()).map(([username, agg]) => ({$/", "language": "TypeScript", "kind": "constant", "scope": "SupabaseService.getLeaderboard", "scopeKind": "method"}, {"_type": "tag", "name": "saveScore", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^  async saveScore(username: string, result: GameResult): Promise<{ ok: true } | { ok: false; mes/", "language": "TypeScript", "kind": "method", "scope": "SupabaseService", "scopeKind": "class"}, {"_type": "tag", "name": "schemaHelpMessage", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^  private schemaHelpMessage(): string {$/", "language": "TypeScript", "kind": "method", "scope": "SupabaseService", "scopeKind": "class"}, {"_type": "tag", "name": "total_score", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^  total_score: number;$/", "language": "TypeScript", "kind": "property", "scope": "LeaderboardRow", "scopeKind": "interface"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^    const url = NG_APP_SUPABASE_URL;$/", "language": "TypeScript", "kind": "constant", "scope": "SupabaseService.constructor", "scopeKind": "method"}, {"_type": "tag", "name": "username", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^  username: string;$/", "language": "TypeScript", "kind": "property", "scope": "LeaderboardRow", "scopeKind": "interface"}, {"_type": "tag", "name": "username", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^  username: string;$/", "language": "TypeScript", "kind": "property", "scope": "ScoreRow", "scopeKind": "interface"}, {"_type": "tag", "name": "warnedAboutSchema", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-score-tracker-301751-301763/tic_tac_toe_frontend/src/app/services/supabase.service.ts", "pattern": "/^  private warnedAboutSchema = false;$/", "language": "TypeScript", "kind": "property", "scope": "SupabaseService", "scopeKind": "class"}], "hash": "eb2893b2248fc413cd79e9018f8d29c4", "format-version": 4, "code-base-name": "tic_tac_toe_frontend", "filename": "tic_tac_toe_frontend/src/app/services/supabase.service.ts", "fields": [{"name": "export interface LeaderboardRow {", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "interface ScoreRow {", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "private readonly client: SupabaseClient | null;", "scope": "SupabaseService", "scopeKind": "class", "description": "unavailable"}, {"name": "created_at?: string;", "scope": "ScoreRow", "scopeKind": "interface", "description": "unavailable"}, {"name": "id?: string;", "scope": "ScoreRow", "scopeKind": "interface", "description": "unavailable"}, {"name": "latest_played: string;", "scope": "LeaderboardRow", "scopeKind": "interface", "description": "unavailable"}, {"name": "result: number; \\/\\/ 1 | 0.5 | 0", "scope": "ScoreRow", "scopeKind": "interface", "description": "unavailable"}, {"name": "total_score: number;", "scope": "LeaderboardRow", "scopeKind": "interface", "description": "unavailable"}, {"name": "username: string;", "scope": "LeaderboardRow", "scopeKind": "interface", "description": "unavailable"}, {"name": "private warnedAboutSchema = false;", "scope": "SupabaseService", "scopeKind": "class", "description": "unavailable"}]}